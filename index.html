<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>霊夢の賽銭ゲーム</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      text-align: center;
      background-color: #fffbe6;
      font-family: 'Arial', sans-serif;
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 480px;
      margin: 0 auto;
      padding: 20px;
    }

    h1 {
      font-size: 24px;
      margin: 10px 0 20px;
    }

    #reimu, #saisenbako {
      width: 100%;
      max-width: 200px;
      height: auto;
      margin: 10px auto;
      display: block;
    }

    #message {
      margin: 10px;
      font-size: 18px;
      color: #c00;
      min-height: 24px;
    }

    #coin-button {
      padding: 12px 24px;
      font-size: 18px;
      background-color: gold;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 20px;
    }

    #coin-count, #cps {
      font-size: 16px;
      margin-top: 10px;
    }

    footer {
      margin-top: 40px;
      font-size: 14px;
      color: #666;
    }

    a {
      color: #666;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>霊夢に賽銭を投げよう！</h1>

    <img id="reimu" src="reimu_normal.png" alt="霊夢の表情">
    <img id="saisenbako" src="saisen.png" alt="賽銭箱">

    <div id="message">賽銭まだ？</div>
    <button id="coin-button">賽銭を投げる！</button>
    <div id="coin-count">賽銭の数: 0</div>
    <div id="cps">CPS: 0</div>

    <footer>
      霊夢立ち絵: <a href="https://twitter.com/_Hoshi_Ringo_" target="_blank">星りんご (@_Hoshi_Ringo_)</a>
    </footer>
  </div>

  <!-- 効果音 -->
  <audio id="coin-sound">
    <source src="https://freesound.org/data/previews/341/341695_3248244-lq.mp3" type="audio/mpeg">
  </audio>

  <!-- BGM -->
  <audio id="bgm" loop>
    <source src="https://dl.vgmdownloads.com/soundtracks/touhou-6-embodiment-of-scarlet-devil/waqnbmyy/103%20-%20Shrine%20Maiden%20of%20the%20Wind.mp3" type="audio/mpeg">
  </audio>

  <script>
    const messageDiv = document.getElementById("message");
    const coinCountDiv = document.getElementById("coin-count");
    const cpsDiv = document.getElementById("cps");
    const coinButton = document.getElementById("coin-button");
    const coinSound = document.getElementById("coin-sound");
    const bgm = document.getElementById("bgm");
    const reimuImg = document.getElementById("reimu");

    let coinCount = 0;
    let bgmStarted = false;
    let clickTimes = [];
    let lastTouchTime = 0;

    const reimuFaces = {
      normal: "reimu_normal.png",
      happy: "reimu_happy.png",
      excited: "reimu_excited.png",
      angry: "reimu_angry.png"
    };

    const saisenLines = [
      { count: 0, line: "賽銭まだ？", face: "normal" },
      { count: 5, line: "ちょっとは信仰あるのね", face: "happy" },
      { count: 10, line: "いい感じじゃない？", face: "happy" },
      { count: 15, line: "もっと投げてもいいのよ？", face: "happy" },
      { count: 20, line: "ふふっ、調子出てきたわ", face: "excited" },
      { count: 25, line: "毎日来なさい", face: "excited" },
      { count: 30, line: "神社の修理代が捗るわ", face: "happy" },
      { count: 35, line: "まだまだよ", face: "angry" },
      { count: 40, line: "そこまでやるなら巫女になれば？", face: "angry" },
      { count: 45, line: "私に惚れた？…冗談よ", face: "excited" },
      { count: 50, line: "信仰が暴走してるわね", face: "angry" },
      { count: 60, line: "ちょっと真面目に嬉しいかも", face: "happy" },
      { count: 70, line: "もう止まらないわね", face: "excited" },
      { count: 80, line: "あんた霊夢専属信者でしょ", face: "happy" },
      { count: 90, line: "今日の勝者はあなた！", face: "excited" },
      { count: 100, line: "本殿を金ピカにしてやろうかしら", face: "angry" },
      { count: 150, line: "神主にも見せてやりたいわね", face: "excited" },
      { count: 200, line: "これはもう信仰じゃなくて愛ね", face: "happy" },
      { count: 300, line: "あなたが神か…", face: "angry" },
      { count: 500, line: "信仰の化身。尊敬するわ", face: "happy" },
      { count: 1000, line: "神社が神界になったわ", face: "angry" }
    ];

    function updateCPS() {
      const now = Date.now();
      clickTimes = clickTimes.filter(t => now - t < 1000);
      cpsDiv.textContent = `CPS: ${clickTimes.length}`;
    }

    function throwCoin() {
      const now = Date.now();
      clickTimes.push(now);
      updateCPS();

      coinCount++;
      coinSound.currentTime = 0;
      coinSound.play();
      coinCountDiv.textContent = `賽銭の数: ${coinCount}`;

      if (!bgmStarted) {
        bgm.play();
        bgmStarted = true;
      }

      let selectedLine = saisenLines[0];
      for (let i = 0; i < saisenLines.length; i++) {
        if (coinCount >= saisenLines[i].count) {
          selectedLine = saisenLines[i];
        } else {
          break;
        }
      }

      messageDiv.textContent = selectedLine.line;
      reimuImg.src = reimuFaces[selectedLine.face];
    }

    coinButton.addEventListener("mousedown", throwCoin);
    coinButton.addEventListener("touchstart", (e) => {
      const now = Date.now();
      if (now - lastTouchTime > 500) {
        throwCoin();
        lastTouchTime = now;
      }
    });

    setInterval(updateCPS, 200);
  </script>
</body>
</html>
